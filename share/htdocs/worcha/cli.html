<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worcha CLI - Conversational Interface</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.3/dist/cdn.min.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #0f0f0f;
            color: #00ff00;
            height: 100vh;
            overflow: hidden;
        }

        .cli-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .cli-header {
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .cli-title {
            color: #00ffff;
            font-size: 18px;
            font-weight: bold;
        }

        .cli-subtitle {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
        }

        .cli-output {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            line-height: 1.6;
        }

        .cli-line {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .cli-prompt {
            color: #00ffff;
        }

        .cli-command {
            color: #ffff00;
        }

        .cli-output-text {
            color: #00ff00;
        }

        .cli-error {
            color: #ff4444;
        }

        .cli-success {
            color: #44ff44;
        }

        .cli-info {
            color: #4444ff;
        }

        .cli-warning {
            color: #ffaa00;
        }

        .cli-input-area {
            border-top: 1px solid #333;
            padding-top: 10px;
            display: flex;
            align-items: center;
        }

        .cli-prompt-symbol {
            color: #00ffff;
            margin-right: 8px;
        }

        .cli-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffff00;
            font-family: inherit;
            font-size: 14px;
            outline: none;
        }

        .cli-input::placeholder {
            color: #666;
        }

        /* Typing animation */
        .typing {
            position: relative;
        }

        .typing::after {
            content: '▋';
            animation: blink 1s infinite;
            color: #00ff00;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Suggestions */
        .cli-suggestions {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .cli-suggestion {
            padding: 8px 12px;
            color: #888;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }

        .cli-suggestion:hover {
            background: #333;
            color: #00ff00;
        }

        .cli-suggestion:last-child {
            border-bottom: none;
        }

        /* Command help */
        .cli-help {
            color: #888;
            font-style: italic;
            margin-left: 20px;
        }

        /* Tables */
        .cli-table {
            margin: 10px 0;
        }

        .cli-table-header {
            color: #00ffff;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }

        .cli-table-row {
            display: grid;
            grid-template-columns: 120px 200px 100px 1fr;
            gap: 20px;
            padding: 3px 0;
            border-bottom: 1px solid #222;
        }

        .cli-table-cell {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ASCII Art */
        .ascii-art {
            color: #00ffff;
            font-size: 10px;
            line-height: 1;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div x-data="worchaCLI" x-init="init()" class="cli-container">
        <!-- Header -->
        <div class="cli-header">
            <div class="cli-title">WORCHA CLI v1.0</div>
            <div class="cli-subtitle">Conversational Workforce Orchestrator | Type 'help' for commands</div>
        </div>

        <!-- Output Area -->
        <div class="cli-output" x-ref="output">
            <template x-for="(line, index) in outputLines" :key="index">
                <div class="cli-line" :class="line.type" x-html="line.content"></div>
            </template>
            <div x-show="isTyping" class="cli-line typing">
                <span x-text="typingText"></span>
            </div>
        </div>

        <!-- Suggestions -->
        <div x-show="suggestions.length > 0" class="cli-suggestions">
            <template x-for="suggestion in suggestions" :key="suggestion.command">
                <div class="cli-suggestion" @click="selectSuggestion(suggestion)">
                    <strong x-text="suggestion.command"></strong>
                    <span class="cli-help" x-text="suggestion.description"></span>
                </div>
            </template>
        </div>

        <!-- Input Area -->
        <div class="cli-input-area">
            <span class="cli-prompt-symbol">worcha$</span>
            <input 
                type="text" 
                class="cli-input" 
                x-model="currentInput"
                @keydown.enter="processCommand()"
                @keydown.tab.prevent="autoComplete()"
                @input="updateSuggestions()"
                @keydown.arrow-up.prevent="historyUp()"
                @keydown.arrow-down.prevent="historyDown()"
                placeholder="Type your command or question..."
                x-ref="input"
                autocomplete="off"
            >
        </div>
    </div>

    <script>
        function worchaCLI() {
            return {
                // State
                currentInput: '',
                outputLines: [],
                commandHistory: [],
                historyIndex: -1,
                isTyping: false,
                typingText: '',
                suggestions: [],
                
                // Data (same as main app but CLI-focused)
                tasks: [],
                projects: [],
                teamMembers: [],
                
                // Command definitions
                commands: {
                    'help': {
                        description: 'Show available commands',
                        aliases: ['?', 'commands'],
                        handler: 'showHelp'
                    },
                    'list': {
                        description: 'List tasks, projects, or team members',
                        aliases: ['ls', 'show'],
                        handler: 'listItems',
                        usage: 'list [tasks|projects|team|epics|stories]'
                    },
                    'create': {
                        description: 'Create a new item',
                        aliases: ['add', 'new', 'make'],
                        handler: 'createItem',
                        usage: 'create [task|project|epic|story] "title" [description]'
                    },
                    'assign': {
                        description: 'Assign a task to someone',
                        aliases: ['give'],
                        handler: 'assignTask',
                        usage: 'assign task123 to john'
                    },
                    'status': {
                        description: 'Change item status',
                        aliases: ['move', 'set'],
                        handler: 'updateStatus',
                        usage: 'status task123 doing'
                    },
                    'find': {
                        description: 'Search for items',
                        aliases: ['search', 'grep'],
                        handler: 'searchItems',
                        usage: 'find "search term"'
                    },
                    'my': {
                        description: 'Show your assigned tasks',
                        aliases: ['mine'],
                        handler: 'showMyTasks',
                        usage: 'my [tasks|work]'
                    },
                    'team': {
                        description: 'Show team information',
                        aliases: ['people'],
                        handler: 'showTeam',
                        usage: 'team [member_name]'
                    },
                    'stats': {
                        description: 'Show statistics and metrics',
                        aliases: ['metrics', 'analytics'],
                        handler: 'showStats',
                        usage: 'stats [team|project|tasks]'
                    },
                    'clear': {
                        description: 'Clear the screen',
                        aliases: ['cls'],
                        handler: 'clearScreen'
                    }
                },

                // Natural language patterns
                nlPatterns: [
                    {
                        pattern: /^(what|show me|list).*(task|todo)/i,
                        command: 'list tasks'
                    },
                    {
                        pattern: /^(who|what).*(team|people)/i,
                        command: 'team'
                    },
                    {
                        pattern: /^(create|make|add).*(task|todo)/i,
                        command: 'create task'
                    },
                    {
                        pattern: /^(assign|give).*(task|todo)/i,
                        command: 'assign'
                    },
                    {
                        pattern: /^(my|mine).*(task|work)/i,
                        command: 'my tasks'
                    },
                    {
                        pattern: /^(how many|count|stats)/i,
                        command: 'stats'
                    }
                ],

                async init() {
                    await this.loadData();
                    this.showWelcome();
                    this.$refs.input.focus();
                },

                showWelcome() {
                    this.addOutput(`
 ██╗    ██╗ ██████╗ ██████╗  ██████╗██╗  ██╗ █████╗ 
 ██║    ██║██╔═══██╗██╔══██╗██╔════╝██║  ██║██╔══██╗
 ██║ █╗ ██║██║   ██║██████╔╝██║     ███████║███████║
 ██║███╗██║██║   ██║██╔══██╗██║     ██╔══██║██╔══██║
 ╚███╔███╔╝╚██████╔╝██║  ██║╚██████╗██║  ██║██║  ██║
  ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝
`, 'ascii-art');
                    
                    this.addOutput('Welcome to Worcha CLI - Conversational Workforce Orchestrator!', 'cli-success');
                    this.addOutput('Type naturally or use commands. Try: "show me tasks" or "what team"', 'cli-info');
                    this.addOutput('Type "help" for available commands.', 'cli-info');
                    this.addOutput('');
                },

                async loadData() {
                    // Load sample data (same structure as main app)
                    this.tasks = [
                        {
                            id: 'task_1',
                            title: 'Create login form HTML',
                            description: 'Build responsive HTML structure',
                            status: 'done',
                            assignee: 'alex',
                            type: 'Development',
                            priority: 'high'
                        },
                        {
                            id: 'task_2',
                            title: 'Style login form',
                            description: 'Apply CSS styling',
                            status: 'done',
                            assignee: 'sarah',
                            type: 'Design',
                            priority: 'medium'
                        },
                        {
                            id: 'task_3',
                            title: 'Design registration UI',
                            description: 'Create mockups for registration',
                            status: 'doing',
                            assignee: 'sarah',
                            type: 'Design',
                            priority: 'high'
                        },
                        {
                            id: 'task_4',
                            title: 'Implement validation',
                            description: 'Add form validation',
                            status: 'todo',
                            assignee: 'alex',
                            type: 'Development',
                            priority: 'high'
                        }
                    ];

                    this.teamMembers = [
                        { id: 'alex', name: 'Alex Johnson', role: 'Full Stack Developer' },
                        { id: 'sarah', name: 'Sarah Chen', role: 'UI/UX Designer' },
                        { id: 'mike', name: 'Mike Rodriguez', role: 'Backend Developer' },
                        { id: 'emma', name: 'Emma Williams', role: 'Product Manager' }
                    ];

                    this.projects = [
                        { id: 'proj_1', name: 'Mobile Banking App', status: 'active' },
                        { id: 'proj_2', name: 'Customer Portal', status: 'active' }
                    ];
                },

                addOutput(content, type = 'cli-output-text') {
                    this.outputLines.push({
                        content: content,
                        type: type,
                        timestamp: new Date()
                    });
                    this.$nextTick(() => {
                        this.$refs.output.scrollTop = this.$refs.output.scrollHeight;
                    });
                },

                async processCommand() {
                    if (!this.currentInput.trim()) return;

                    const input = this.currentInput.trim();
                    this.addOutput(`<span class="cli-prompt">worcha$</span> <span class="cli-command">${input}</span>`);
                    
                    // Add to history
                    this.commandHistory.unshift(input);
                    this.historyIndex = -1;
                    
                    // Clear suggestions
                    this.suggestions = [];

                    try {
                        await this.executeCommand(input);
                    } catch (error) {
                        this.addOutput(`Error: ${error.message}`, 'cli-error');
                    }

                    this.currentInput = '';
                },

                async executeCommand(input) {
                    // Check for natural language patterns first
                    const nlCommand = this.parseNaturalLanguage(input);
                    if (nlCommand) {
                        input = nlCommand;
                    }

                    const parts = input.split(' ').filter(p => p.length > 0);
                    const command = parts[0].toLowerCase();
                    const args = parts.slice(1);

                    // Find command (including aliases)
                    let cmdDef = this.commands[command];
                    if (!cmdDef) {
                        for (const [cmd, def] of Object.entries(this.commands)) {
                            if (def.aliases && def.aliases.includes(command)) {
                                cmdDef = def;
                                break;
                            }
                        }
                    }

                    if (cmdDef) {
                        await this[cmdDef.handler](args, input);
                    } else {
                        this.addOutput(`Unknown command: "${command}". Type "help" for available commands.`, 'cli-error');
                    }
                },

                parseNaturalLanguage(input) {
                    for (const pattern of this.nlPatterns) {
                        if (pattern.pattern.test(input)) {
                            this.addOutput(`🤖 Interpreting: "${input}" → "${pattern.command}"`, 'cli-info');
                            return pattern.command;
                        }
                    }
                    return null;
                },

                // Command Handlers
                async showHelp(args) {
                    this.addOutput('Available Commands:', 'cli-success');
                    this.addOutput('');
                    
                    for (const [cmd, def] of Object.entries(this.commands)) {
                        const aliases = def.aliases ? ` (${def.aliases.join(', ')})` : '';
                        this.addOutput(`  <span class="cli-command">${cmd}${aliases}</span>`);
                        this.addOutput(`    ${def.description}`, 'cli-info');
                        if (def.usage) {
                            this.addOutput(`    Usage: ${def.usage}`, 'cli-help');
                        }
                        this.addOutput('');
                    }
                    
                    this.addOutput('Natural Language Examples:', 'cli-success');
                    this.addOutput('  "show me tasks"', 'cli-command');
                    this.addOutput('  "what team members do we have"', 'cli-command');
                    this.addOutput('  "create a new task"', 'cli-command');
                    this.addOutput('  "my tasks"', 'cli-command');
                },

                async listItems(args) {
                    const type = args[0] || 'tasks';
                    
                    switch (type.toLowerCase()) {
                        case 'tasks':
                        case 'task':
                            this.listTasks();
                            break;
                        case 'team':
                        case 'people':
                            this.listTeam();
                            break;
                        case 'projects':
                        case 'project':
                            this.listProjects();
                            break;
                        default:
                            this.addOutput(`Unknown list type: ${type}. Try: tasks, team, projects`, 'cli-error');
                    }
                },

                listTasks() {
                    this.addOutput(`📋 Tasks (${this.tasks.length} total):`, 'cli-success');
                    this.addOutput('');
                    
                    if (this.tasks.length === 0) {
                        this.addOutput('No tasks found.', 'cli-info');
                        return;
                    }

                    // Table header
                    this.addOutput('<div class="cli-table-header">ID           TITLE                    STATUS     ASSIGNEE</div>');
                    
                    // Table rows
                    for (const task of this.tasks) {
                        const status = this.getStatusEmoji(task.status);
                        const assignee = this.getTeamMemberName(task.assignee);
                        this.addOutput(`<div class="cli-table-row">
                            <div class="cli-table-cell">${task.id}</div>
                            <div class="cli-table-cell">${task.title}</div>
                            <div class="cli-table-cell">${status} ${task.status}</div>
                            <div class="cli-table-cell">${assignee}</div>
                        </div>`);
                    }
                    this.addOutput('');
                },

                listTeam() {
                    this.addOutput(`👥 Team Members (${this.teamMembers.length} total):`, 'cli-success');
                    this.addOutput('');
                    
                    for (const member of this.teamMembers) {
                        const tasks = this.tasks.filter(t => t.assignee === member.id);
                        this.addOutput(`  <span class="cli-command">${member.name}</span> - ${member.role}`);
                        this.addOutput(`    Active tasks: ${tasks.length}`, 'cli-info');
                        this.addOutput('');
                    }
                },

                listProjects() {
                    this.addOutput(`📁 Projects (${this.projects.length} total):`, 'cli-success');
                    this.addOutput('');
                    
                    for (const project of this.projects) {
                        this.addOutput(`  <span class="cli-command">${project.name}</span> (${project.status})`);
                    }
                    this.addOutput('');
                },

                async createItem(args, fullInput) {
                    if (args.length < 2) {
                        this.addOutput('Usage: create [type] "title" [description]', 'cli-error');
                        this.addOutput('Types: task, project, epic, story', 'cli-info');
                        return;
                    }

                    const type = args[0];
                    const title = args.slice(1).join(' ').replace(/['"]/g, '');
                    
                    const newItem = {
                        id: this.generateId(),
                        title: title,
                        status: 'todo',
                        createdAt: new Date()
                    };

                    switch (type.toLowerCase()) {
                        case 'task':
                            newItem.type = 'Development';
                            newItem.assignee = null;
                            this.tasks.push(newItem);
                            this.addOutput(`✅ Created task: "${title}" (${newItem.id})`, 'cli-success');
                            break;
                        default:
                            this.addOutput(`Unknown type: ${type}. Supported: task`, 'cli-error');
                    }
                },

                async assignTask(args) {
                    if (args.length < 3 || args[1] !== 'to') {
                        this.addOutput('Usage: assign [task_id] to [person]', 'cli-error');
                        return;
                    }

                    const taskId = args[0];
                    const assignee = args[2];
                    
                    const task = this.tasks.find(t => t.id === taskId || t.title.toLowerCase().includes(taskId.toLowerCase()));
                    const member = this.teamMembers.find(m => 
                        m.id === assignee || 
                        m.name.toLowerCase().includes(assignee.toLowerCase())
                    );

                    if (!task) {
                        this.addOutput(`Task not found: ${taskId}`, 'cli-error');
                        return;
                    }

                    if (!member) {
                        this.addOutput(`Team member not found: ${assignee}`, 'cli-error');
                        return;
                    }

                    task.assignee = member.id;
                    this.addOutput(`✅ Assigned "${task.title}" to ${member.name}`, 'cli-success');
                },

                async updateStatus(args) {
                    if (args.length < 2) {
                        this.addOutput('Usage: status [task_id] [new_status]', 'cli-error');
                        this.addOutput('Statuses: todo, doing, review, done', 'cli-info');
                        return;
                    }

                    const taskId = args[0];
                    const newStatus = args[1];
                    const validStatuses = ['todo', 'doing', 'review', 'done'];

                    if (!validStatuses.includes(newStatus)) {
                        this.addOutput(`Invalid status: ${newStatus}. Valid: ${validStatuses.join(', ')}`, 'cli-error');
                        return;
                    }

                    const task = this.tasks.find(t => t.id === taskId || t.title.toLowerCase().includes(taskId.toLowerCase()));
                    
                    if (!task) {
                        this.addOutput(`Task not found: ${taskId}`, 'cli-error');
                        return;
                    }

                    const oldStatus = task.status;
                    task.status = newStatus;
                    this.addOutput(`✅ Updated "${task.title}" from ${oldStatus} to ${newStatus}`, 'cli-success');
                },

                async searchItems(args) {
                    const searchTerm = args.join(' ').replace(/['"]/g, '').toLowerCase();
                    
                    if (!searchTerm) {
                        this.addOutput('Usage: find "search term"', 'cli-error');
                        return;
                    }

                    const results = this.tasks.filter(task => 
                        task.title.toLowerCase().includes(searchTerm) ||
                        task.description.toLowerCase().includes(searchTerm)
                    );

                    this.addOutput(`🔍 Search results for "${searchTerm}":`, 'cli-success');
                    this.addOutput('');

                    if (results.length === 0) {
                        this.addOutput('No results found.', 'cli-info');
                        return;
                    }

                    for (const task of results) {
                        const assignee = this.getTeamMemberName(task.assignee);
                        this.addOutput(`  <span class="cli-command">${task.title}</span> (${task.id})`);
                        this.addOutput(`    Status: ${task.status} | Assignee: ${assignee}`, 'cli-info');
                        this.addOutput('');
                    }
                },

                async showMyTasks(args) {
                    // For demo, assume current user is 'alex'
                    const currentUser = 'alex';
                    const myTasks = this.tasks.filter(t => t.assignee === currentUser);

                    this.addOutput(`📋 Your tasks (${myTasks.length} total):`, 'cli-success');
                    this.addOutput('');

                    if (myTasks.length === 0) {
                        this.addOutput('No tasks assigned to you.', 'cli-info');
                        return;
                    }

                    for (const task of myTasks) {
                        const status = this.getStatusEmoji(task.status);
                        this.addOutput(`  ${status} <span class="cli-command">${task.title}</span>`);
                        this.addOutput(`    Status: ${task.status} | Priority: ${task.priority}`, 'cli-info');
                        this.addOutput('');
                    }
                },

                async showTeam(args) {
                    if (args.length > 0) {
                        const memberName = args.join(' ');
                        const member = this.teamMembers.find(m => 
                            m.name.toLowerCase().includes(memberName.toLowerCase())
                        );
                        
                        if (member) {
                            const tasks = this.tasks.filter(t => t.assignee === member.id);
                            this.addOutput(`👤 ${member.name}`, 'cli-success');
                            this.addOutput(`Role: ${member.role}`, 'cli-info');
                            this.addOutput(`Active tasks: ${tasks.length}`, 'cli-info');
                            this.addOutput('');
                            
                            if (tasks.length > 0) {
                                this.addOutput('Current tasks:', 'cli-info');
                                for (const task of tasks) {
                                    const status = this.getStatusEmoji(task.status);
                                    this.addOutput(`  ${status} ${task.title}`);
                                }
                            }
                        } else {
                            this.addOutput(`Team member not found: ${memberName}`, 'cli-error');
                        }
                    } else {
                        this.listTeam();
                    }
                },

                async showStats(args) {
                    const totalTasks = this.tasks.length;
                    const doneTasks = this.tasks.filter(t => t.status === 'done').length;
                    const activeTasks = this.tasks.filter(t => ['todo', 'doing', 'review'].includes(t.status)).length;

                    this.addOutput('📊 Worcha Statistics:', 'cli-success');
                    this.addOutput('');
                    this.addOutput(`Total Tasks: ${totalTasks}`, 'cli-info');
                    this.addOutput(`Completed: ${doneTasks}`, 'cli-info');
                    this.addOutput(`Active: ${activeTasks}`, 'cli-info');
                    this.addOutput(`Team Members: ${this.teamMembers.length}`, 'cli-info');
                    this.addOutput('');

                    // Task distribution by status
                    const statusCounts = {};
                    this.tasks.forEach(task => {
                        statusCounts[task.status] = (statusCounts[task.status] || 0) + 1;
                    });

                    this.addOutput('Task Distribution:', 'cli-success');
                    for (const [status, count] of Object.entries(statusCounts)) {
                        const emoji = this.getStatusEmoji(status);
                        this.addOutput(`  ${emoji} ${status}: ${count}`, 'cli-info');
                    }
                },

                async clearScreen() {
                    this.outputLines = [];
                    this.showWelcome();
                },

                // Utility functions
                updateSuggestions() {
                    if (!this.currentInput.trim()) {
                        this.suggestions = [];
                        return;
                    }

                    const input = this.currentInput.toLowerCase();
                    this.suggestions = [];

                    // Command suggestions
                    for (const [cmd, def] of Object.entries(this.commands)) {
                        if (cmd.startsWith(input)) {
                            this.suggestions.push({
                                command: cmd,
                                description: def.description
                            });
                        }
                        
                        // Check aliases
                        if (def.aliases) {
                            for (const alias of def.aliases) {
                                if (alias.startsWith(input) && !this.suggestions.find(s => s.command === cmd)) {
                                    this.suggestions.push({
                                        command: alias,
                                        description: def.description
                                    });
                                }
                            }
                        }
                    }

                    // Limit suggestions
                    this.suggestions = this.suggestions.slice(0, 5);
                },

                selectSuggestion(suggestion) {
                    this.currentInput = suggestion.command + ' ';
                    this.suggestions = [];
                    this.$refs.input.focus();
                },

                autoComplete() {
                    if (this.suggestions.length > 0) {
                        this.selectSuggestion(this.suggestions[0]);
                    }
                },

                historyUp() {
                    if (this.historyIndex < this.commandHistory.length - 1) {
                        this.historyIndex++;
                        this.currentInput = this.commandHistory[this.historyIndex];
                    }
                },

                historyDown() {
                    if (this.historyIndex > 0) {
                        this.historyIndex--;
                        this.currentInput = this.commandHistory[this.historyIndex];
                    } else if (this.historyIndex === 0) {
                        this.historyIndex = -1;
                        this.currentInput = '';
                    }
                },

                getStatusEmoji(status) {
                    const emojis = {
                        'todo': '📝',
                        'doing': '⚡',
                        'review': '👀',
                        'done': '✅'
                    };
                    return emojis[status] || '❓';
                },

                getTeamMemberName(id) {
                    const member = this.teamMembers.find(m => m.id === id);
                    return member ? member.name : 'Unassigned';
                },

                generateId() {
                    return 'task_' + Math.random().toString(36).substr(2, 9);
                }
            };
        }
    </script>
</body>
</html>