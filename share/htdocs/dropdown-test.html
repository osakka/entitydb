<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Test - EntityDB</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.3/dist/cdn.min.js" defer></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .test-results {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            min-height: 100px;
        }
        .tab {
            background: none;
            border: none;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: 500;
            color: #555;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .tab:hover {
            background-color: #f5f5f5;
        }
        .dropdown-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #3498db;
            color: white;
            min-width: 200px;
            justify-content: space-between;
        }
        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            min-width: 200px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }
        .dropdown-item {
            padding: 8px 15px;
            color: #333;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: block !important;
            border-bottom: 1px solid #eee;
        }
        .dropdown-item:hover {
            background-color: #f5f5f5;
        }
        .simple-dropdown {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            width: 200px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #2980b9;
        }
        /* Console styles */
        .debug-console {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .debug-console-header {
            background: #f5f5f5;
            padding: 8px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        .debug-console-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
            font-family: monospace;
        }
        .console-log {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid #eee;
        }
        .console-log.error {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>EntityDB Dropdown Component Test</h1>
    <p>This page contains isolated tests for the dropdown component to debug functionality.</p>

    <div class="test-section">
        <h2>Test 1: Basic Alpine.js Toggle</h2>
        <div x-data="{ open: false }">
            <button @click="open = !open" class="btn">Toggle Content</button>
            <div x-show="open" style="margin-top: 10px; padding: 10px; background: #f5f5f5;">
                This content should toggle when you click the button.
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 2: Simple Dropdown</h2>
        <div x-data="{ open: false, selectedType: 'All' }">
            <button @click="open = !open" class="tab dropdown-button">
                <span x-text="selectedType"></span> <span x-text="open ? '‚ñ≤' : '‚ñº'"></span>
            </button>
            <div x-show="open" class="simple-dropdown">
                <div @click="selectedType = 'All Entities'; open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px; background: #f5f5f5;">
                    All Entities
                </div>
                <div @click="selectedType = 'Users'; open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Users
                </div>
                <div @click="selectedType = 'Sessions'; open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Sessions
                </div>
                <div @click="selectedType = 'Issues'; open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Issues
                </div>
                <div @click="selectedType = 'Tests'; open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Tests
                </div>
            </div>
            <div class="test-results">
                <p>Selected: <strong x-text="selectedType"></strong></p>
                <p>Dropdown state: <strong x-text="open ? 'Open' : 'Closed'"></strong></p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Integrating with Main App Functions</h2>
        <div x-data="dropdownTest">
            <button @click="open = !open" class="tab dropdown-button">
                Entity Types <span x-text="open ? '‚ñ≤' : '‚ñº'"></span>
            </button>
            <div x-show="open" class="simple-dropdown">
                <div @click="changeTab('all'); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px; background: #f5f5f5;">
                    All Entities
                </div>
                <div @click="changeTab('user'); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Users
                </div>
                <div @click="changeTab('session'); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Sessions
                </div>
                <div @click="changeTab('issue'); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Issues
                </div>
                <div @click="changeTab('test'); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px;">
                    Tests
                </div>
                <div @click="logState(); open = false" 
                    style="padding: 8px; cursor: pointer; margin-bottom: 5px; background: #ffe; color: #333; font-weight: bold;">
                    üêû Debug Info
                </div>
            </div>
            <div class="test-results">
                <p>Active Tab: <strong x-text="activeTab"></strong></p>
                <p>Filter Type: <strong x-text="filterType"></strong></p>
            </div>
        </div>
    </div>

    <!-- Debug Console -->
    <div x-data="debugConsole" class="debug-console">
        <div class="debug-console-header">
            Debug Console <span x-text="logs.length"></span>
            <button @click="clearLogs" class="btn" style="padding: 2px 8px; font-size: 12px;">Clear</button>
        </div>
        <div class="debug-console-content">
            <template x-for="(log, index) in logs" :key="index">
                <div class="console-log" :class="log.type">
                    <span x-text="log.time"></span>: <span x-text="log.message"></span>
                </div>
            </template>
        </div>
    </div>

    <script>
        // Test component
        function dropdownTest() {
            return {
                open: false,
                activeTab: 'all',
                filterType: '',
                
                changeTab(tab) {
                    this.activeTab = tab;
                    this.filterType = tab === 'all' ? '' : tab;
                    this.logAction(`Changed tab to ${tab}`);
                },
                
                logState() {
                    const state = {
                        activeTab: this.activeTab,
                        filterType: this.filterType,
                        open: this.open
                    };
                    console.log('Current state:', state);
                    this.logAction(`Logged state: ${JSON.stringify(state)}`);
                },
                
                logAction(message) {
                    if (window.debugConsole) {
                        window.debugConsole.addLog('info', message);
                    } else {
                        console.log(message);
                    }
                }
            };
        }
        
        // Debug console
        function debugConsole() {
            return {
                logs: [],
                
                init() {
                    window.debugConsole = this;
                    
                    const originalConsoleLog = console.log;
                    const originalConsoleError = console.error;
                    const originalConsoleWarn = console.warn;
                    const self = this;
                    
                    console.log = function() {
                        originalConsoleLog.apply(console, arguments);
                        self.addLog('log', Array.from(arguments).join(' '));
                    };
                    
                    console.error = function() {
                        originalConsoleError.apply(console, arguments);
                        self.addLog('error', Array.from(arguments).join(' '));
                    };
                    
                    console.warn = function() {
                        originalConsoleWarn.apply(console, arguments);
                        self.addLog('warning', Array.from(arguments).join(' '));
                    };
                    
                    // Initial log
                    this.addLog('info', 'Console initialized');
                    this.logAlpineDetails();
                },
                
                logAlpineDetails() {
                    setTimeout(() => {
                        if (window.Alpine) {
                            this.addLog('info', `Alpine.js version: ${window.Alpine.version}`);
                        } else {
                            this.addLog('error', 'Alpine.js not loaded!');
                        }
                    }, 100);
                },
                
                addLog(type, message) {
                    const now = new Date();
                    const time = now.toLocaleTimeString();
                    this.logs.push({ type, message, time });
                    
                    // Limit logs
                    if (this.logs.length > 50) {
                        this.logs.shift();
                    }
                },
                
                clearLogs() {
                    this.logs = [];
                    this.addLog('info', 'Logs cleared');
                }
            };
        }
        
        // Initialize Alpine.js component data
        document.addEventListener('alpine:init', () => {
            Alpine.data('dropdownTest', dropdownTest);
            Alpine.data('debugConsole', debugConsole);
        });
    </script>
</body>
</html>